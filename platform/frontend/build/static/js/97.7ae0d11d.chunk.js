"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[97],{9097:(e,r,t)=>{t.d(r,{TournamentDetail:()=>B});var n=t(9379),s=t(5043),a=t(9806),l=t(4842),i=t(298),o=t(3969),d=t(2579),c=t(3759),x=t(6020),h=t(4799),u=t(8259),m=t(7443),j=t(756),p=t(6172),g=t(1341),A=t(4375),v=t(4527),y=t(2842),_=t(8315),f=t(9817),b=t(9130),S=t(7121),w=t(9982),T=t(8209),C=t(7186),k=t(6013),I=t(3216),W=t(8677),F=t(9066),D=t(6123),z=t(9723),Z=t(322),L=t(7907),P=t(3593),M=t(3188),E=t(7764),N=t(579);const B=()=>{const{id:e}=(0,I.g)(),{user:r}=(0,F.A)(),{showSuccess:t,showError:B}=(0,D.d)(),O=(0,I.Zp)(),{addMessageHandler:R,removeMessageHandler:$}=(0,z.h)(),[H,J]=(0,s.useState)(null),[U,q]=(0,s.useState)([]),[G,K]=(0,s.useState)([]),[Q,V]=(0,s.useState)(!0),[X,Y]=(0,s.useState)(!1),[ee,re]=(0,s.useState)(null),[te,ne]=(0,s.useState)(null),se=(0,s.useCallback)(async()=>{if(e)try{const[t,n]=await Promise.all([W.kS.getTournament(e),W.kS.getTournamentPlayers(e)]);if(J(t.data),q(n.data||[]),r&&n.data){const e=n.data.some(e=>e.user_id===r.id);Y(e)}if("in_progress"===t.data.status||"completed"===t.data.status)try{const r=await W.kS.getTournamentStandings(e);K(r.data.standings||[])}catch(s){console.error("Failed to fetch standings:",s)}}catch(s){var t,n;B((null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||"Failed to load tournament"),O("/tournaments")}finally{V(!1)}},[e,r,B,O]);(0,s.useEffect)(()=>{se()},[se]),(0,s.useEffect)(()=>{if(!e)return;return R("tournament_update",r=>{var t,n;(null===(t=r.payload)||void 0===t||null===(n=t.tournament)||void 0===n?void 0:n.id)===e&&(J(r.payload.tournament),r.payload.players&&q(r.payload.players))}),R("tournament_started",r=>{var n;(null===(n=r.payload)||void 0===n?void 0:n.tournament_id)===e&&(se(),t("Tournament has started!"))}),R("blind_level_increased",r=>{var t;(null===(t=r.payload)||void 0===t?void 0:t.tournament_id)===e&&J(e=>e?(0,n.A)((0,n.A)({},e),{},{current_level:r.payload.current_level,level_started_at:(new Date).toISOString()}):null)}),R("player_eliminated",r=>{var t;(null===(t=r.payload)||void 0===t?void 0:t.tournament_id)===e&&se()}),R("tournament_complete",r=>{var n;(null===(n=r.payload)||void 0===n?void 0:n.tournament_id)===e&&(se(),t("Tournament complete! Winner: ".concat(r.payload.winner_name)))}),()=>{$("tournament_update"),$("tournament_started"),$("blind_level_increased"),$("player_eliminated"),$("tournament_complete")}},[e,R,$,se,t]),(0,s.useEffect)(()=>{if(!H||"registering"!==H.status)return void re(null);const e=()=>{if(H.start_time){const e=new Date(H.start_time).getTime(),r=Date.now(),t=Math.max(0,Math.floor((e-r)/1e3));re(t)}else if(H.registration_completed_at){const e=new Date(H.registration_completed_at).getTime(),r=Date.now(),t=Math.floor((r-e)/1e3),n=Math.max(0,H.auto_start_delay-t);re(n)}else re(null)};e();const r=setInterval(e,1e3);return()=>clearInterval(r)},[H]),(0,s.useEffect)(()=>{if(!H||"in_progress"!==H.status||!H.level_started_at)return void ne(null);const e=()=>{try{const e=JSON.parse(H.structure).blind_levels[H.current_level-1];if(e){const r=new Date(H.level_started_at).getTime(),t=Date.now(),n=Math.floor((t-r)/1e3),s=Math.max(0,e.duration-n);ne(s)}}catch(e){console.error("Failed to parse tournament structure:",e)}};e();const r=setInterval(e,1e3);return()=>clearInterval(r)},[H]);const ae=e=>{if(null===e)return"--:--";const r=Math.floor(e/60),t=e%60;return"".concat(r.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))};if(Q)return(0,N.jsx)(Z.e,{children:(0,N.jsx)(a.A,{maxWidth:"xl",sx:{py:4},children:(0,N.jsx)(M.k,{})})});if(!H)return(0,N.jsx)(Z.e,{children:(0,N.jsx)(a.A,{maxWidth:"xl",sx:{py:4},children:(0,N.jsx)(l.A,{children:"Tournament not found"})})});const le=JSON.parse(H.structure),ie=le.blind_levels[H.current_level-1],oe=le.blind_levels[H.current_level],de=(null===r||void 0===r?void 0:r.id)===H.creator_id&&"registering"===H.status&&H.current_players>=H.min_players;return(0,N.jsx)(Z.e,{children:(0,N.jsx)(a.A,{maxWidth:"xl",sx:{py:4},children:(0,N.jsxs)(i.A,{spacing:3,children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:2,children:[(0,N.jsx)(d.A,{onClick:()=>O("/tournaments"),sx:{color:E.lm.text.secondary},children:(0,N.jsx)(_.A,{})}),(0,N.jsxs)(o.A,{children:[(0,N.jsx)(l.A,{variant:"h4",fontWeight:"bold",color:E.lm.text.primary,children:H.name}),(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,mt:.5,children:[(0,N.jsx)(c.A,{label:(e=>{switch(e){case"registering":return"Open for Registration";case"starting":return"Starting Soon...";case"in_progress":return"In Progress";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return e}})(H.status),color:(e=>{switch(e){case"registering":return"success";case"starting":return"warning";case"in_progress":return"info";case"completed":default:return"default";case"cancelled":return"error"}})(H.status),size:"small"}),(0,N.jsxs)(l.A,{variant:"body2",color:E.lm.text.secondary,children:["Code: ",H.tournament_code]}),(0,N.jsx)(d.A,{size:"small",onClick:()=>{H&&(navigator.clipboard.writeText(H.tournament_code),t("Tournament code copied to clipboard!"))},children:(0,N.jsx)(f.A,{fontSize:"small"})})]})]})]}),(0,N.jsxs)(i.A,{direction:"row",spacing:2,children:["registering"===H.status&&!X&&(0,N.jsxs)(L.$,{variant:"primary",startIcon:(0,N.jsx)(T.A,{}),onClick:async()=>{if(e)try{await W.kS.registerForTournament(e),t("Successfully registered for tournament!"),se()}catch(s){var r,n;B((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.error)||"Failed to register")}},disabled:H.current_players>=H.max_players,children:["Register (",H.buy_in," chips)"]}),"registering"===H.status&&X&&(0,N.jsx)(L.$,{variant:"ghost",startIcon:(0,N.jsx)(S.A,{}),onClick:async()=>{if(e)try{await W.kS.unregisterFromTournament(e),t("Successfully unregistered from tournament"),se()}catch(s){var r,n;B((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.error)||"Failed to unregister")}},children:"Unregister"}),de&&(0,N.jsx)(L.$,{variant:"success",startIcon:(0,N.jsx)(C.A,{}),onClick:async()=>{if(e)try{await W.kS.startTournament(e),t("Tournament started!"),se()}catch(s){var r,n;B((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.error)||"Failed to start tournament")}},children:"Start Tournament Now"})]})]}),(0,N.jsxs)(o.A,{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(4, 1fr)"},gap:3,children:[(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(i.A,{spacing:1,p:2,children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,N.jsx)(w.A,{sx:{color:E.lm.secondary.main}}),(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Players"})]}),(0,N.jsxs)(l.A,{variant:"h5",fontWeight:"bold",children:[H.current_players," / ",H.max_players]}),(0,N.jsx)(x.A,{variant:"determinate",value:H.current_players/H.max_players*100,sx:{mt:1}}),(0,N.jsxs)(l.A,{variant:"caption",color:E.lm.text.secondary,children:["Min: ",H.min_players]})]})})}),(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(i.A,{spacing:1,p:2,children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,N.jsx)(b.A,{sx:{color:E.lm.warning.main}}),(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Prize Pool"})]}),(0,N.jsxs)(l.A,{variant:"h5",fontWeight:"bold",children:[H.prize_pool.toLocaleString()," chips"]}),(0,N.jsxs)(l.A,{variant:"caption",color:E.lm.text.secondary,children:["Buy-in: ",H.buy_in," chips"]})]})})}),"registering"===H.status&&null!==ee&&(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(i.A,{spacing:1,p:2,children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,N.jsx)(y.A,{sx:{color:E.lm.info.main}}),(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Starts In"})]}),(0,N.jsx)(l.A,{variant:"h5",fontWeight:"bold",sx:{fontFamily:"monospace"},children:ae(ee)}),(0,N.jsx)(l.A,{variant:"caption",color:E.lm.text.secondary,children:H.start_time?"Scheduled start":"Auto-start delay"})]})})}),"in_progress"===H.status&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(i.A,{spacing:1,p:2,children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,N.jsx)(k.A,{sx:{color:E.lm.success.main}}),(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Current Blinds"})]}),(0,N.jsxs)(l.A,{variant:"h5",fontWeight:"bold",children:[null===ie||void 0===ie?void 0:ie.small_blind," / ",null===ie||void 0===ie?void 0:ie.big_blind]}),(0,N.jsxs)(l.A,{variant:"caption",color:E.lm.text.secondary,children:["Level ",H.current_level,(null===ie||void 0===ie?void 0:ie.ante)>0&&" \u2022 Ante: ".concat(ie.ante)]})]})})}),(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(i.A,{spacing:1,p:2,children:[(0,N.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,N.jsx)(y.A,{sx:{color:E.lm.warning.main}}),(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Next Level In"})]}),(0,N.jsx)(l.A,{variant:"h5",fontWeight:"bold",sx:{fontFamily:"monospace"},children:ae(te)}),oe&&(0,N.jsxs)(l.A,{variant:"caption",color:E.lm.text.secondary,children:["Next: ",oe.small_blind,"/",oe.big_blind]})]})})})]})]}),"registering"===H.status&&(0,N.jsx)(P.Z,{children:(0,N.jsxs)(o.A,{p:3,children:[(0,N.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"Registered Players"}),0===U.length?(0,N.jsx)(l.A,{color:E.lm.text.secondary,children:"No players registered yet. Be the first!"}):(0,N.jsx)(o.A,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:2,children:U.map(e=>(0,N.jsx)(o.A,{children:(0,N.jsxs)(h.A,{sx:{p:2,bgcolor:E.lm.background.paper},children:[(0,N.jsx)(l.A,{fontWeight:"bold",children:e.username}),(0,N.jsxs)(l.A,{variant:"caption",color:E.lm.text.secondary,children:["Registered ",new Date(e.registered_at).toLocaleTimeString()]})]})},e.user_id))})]})}),"starting"===H.status&&(0,N.jsx)(P.Z,{children:(0,N.jsxs)(o.A,{p:3,textAlign:"center",children:[(0,N.jsx)(M.k,{}),(0,N.jsx)(l.A,{variant:"h6",mt:2,children:"Tournament is starting..."}),(0,N.jsx)(l.A,{color:E.lm.text.secondary,children:"Please wait while tables are being prepared"})]})}),("in_progress"===H.status||"completed"===H.status)&&G.length>0&&(0,N.jsx)(P.Z,{children:(0,N.jsxs)(o.A,{p:3,children:[(0,N.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"completed"===H.status?"Final Standings":"Current Standings"}),(0,N.jsx)(u.A,{children:(0,N.jsxs)(m.A,{children:[(0,N.jsx)(j.A,{children:(0,N.jsxs)(p.A,{children:[(0,N.jsx)(g.A,{children:"Position"}),(0,N.jsx)(g.A,{children:"Player"}),(0,N.jsx)(g.A,{align:"right",children:"Chips"}),"completed"===H.status&&(0,N.jsx)(g.A,{align:"right",children:"Prize"}),(0,N.jsx)(g.A,{children:"Status"})]})}),(0,N.jsx)(A.A,{children:G.sort((e,r)=>(e.position||999)-(r.position||999)).map(e=>{const r=U.find(r=>r.user_id===e.user_id);return(0,N.jsxs)(p.A,{children:[(0,N.jsx)(g.A,{children:e.position?(0,N.jsx)(c.A,{label:"#".concat(e.position),color:1===e.position?"warning":"default",size:"small"}):"-"}),(0,N.jsx)(g.A,{children:e.username||(null===r||void 0===r?void 0:r.username)||"Unknown"}),(0,N.jsx)(g.A,{align:"right",children:(null===r||void 0===r?void 0:r.chips.toLocaleString())||"-"}),"completed"===H.status&&(0,N.jsx)(g.A,{align:"right",children:e.prize_amount>0?(0,N.jsxs)(l.A,{color:E.lm.success.main,fontWeight:"bold",children:["+",e.prize_amount.toLocaleString()]}):"-"}),(0,N.jsx)(g.A,{children:e.position?(0,N.jsx)(c.A,{label:"Eliminated",size:"small",color:"error"}):(0,N.jsx)(c.A,{label:"Active",size:"small",color:"success"})})]},e.user_id)})})]})})]})}),"cancelled"===H.status&&(0,N.jsx)(P.Z,{children:(0,N.jsxs)(o.A,{p:3,textAlign:"center",children:[(0,N.jsx)(l.A,{variant:"h6",color:"error",mb:1,children:"Tournament Cancelled"}),(0,N.jsx)(l.A,{color:E.lm.text.secondary,children:"This tournament has been cancelled. All buy-ins have been refunded."})]})}),(0,N.jsxs)(o.A,{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:3,children:[(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(o.A,{p:3,children:[(0,N.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"Blind Structure"}),(0,N.jsx)(l.A,{variant:"subtitle2",color:E.lm.text.secondary,mb:2,children:le.name}),(0,N.jsx)(u.A,{children:(0,N.jsxs)(m.A,{size:"small",children:[(0,N.jsx)(j.A,{children:(0,N.jsxs)(p.A,{children:[(0,N.jsx)(g.A,{children:"Level"}),(0,N.jsx)(g.A,{children:"Small/Big"}),(0,N.jsx)(g.A,{children:"Ante"}),(0,N.jsx)(g.A,{children:"Duration"})]})}),(0,N.jsx)(A.A,{children:le.blind_levels.slice(0,10).map(e=>(0,N.jsxs)(p.A,{sx:{bgcolor:e.level===H.current_level?"rgba(25, 118, 210, 0.08)":"transparent"},children:[(0,N.jsx)(g.A,{children:e.level}),(0,N.jsxs)(g.A,{children:[e.small_blind,"/",e.big_blind]}),(0,N.jsx)(g.A,{children:e.ante||"-"}),(0,N.jsxs)(g.A,{children:[e.duration/60," min"]})]},e.level))})]})})]})})}),(0,N.jsx)(o.A,{children:(0,N.jsx)(P.Z,{children:(0,N.jsxs)(o.A,{p:3,children:[(0,N.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"Tournament Info"}),(0,N.jsxs)(i.A,{spacing:2,children:[(0,N.jsxs)(o.A,{children:[(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Starting Chips"}),(0,N.jsx)(l.A,{variant:"body1",fontWeight:"bold",children:H.starting_chips.toLocaleString()})]}),(0,N.jsx)(v.A,{}),(0,N.jsxs)(o.A,{children:[(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Structure"}),(0,N.jsx)(l.A,{variant:"body1",children:le.description})]}),(0,N.jsx)(v.A,{}),(0,N.jsxs)(o.A,{children:[(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Created"}),(0,N.jsx)(l.A,{variant:"body1",children:new Date(H.created_at).toLocaleString()})]}),H.started_at&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(v.A,{}),(0,N.jsxs)(o.A,{children:[(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Started"}),(0,N.jsx)(l.A,{variant:"body1",children:new Date(H.started_at).toLocaleString()})]})]}),H.completed_at&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(v.A,{}),(0,N.jsxs)(o.A,{children:[(0,N.jsx)(l.A,{variant:"body2",color:E.lm.text.secondary,children:"Completed"}),(0,N.jsx)(l.A,{variant:"body1",children:new Date(H.completed_at).toLocaleString()})]})]})]})]})})})]})]})})})}}}]);
//# sourceMappingURL=97.7ae0d11d.chunk.js.map