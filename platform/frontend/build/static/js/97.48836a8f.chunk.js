"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[97],{9097:(e,r,n)=>{n.d(r,{TournamentDetail:()=>O});var t=n(9379),s=n(5043),a=n(9806),l=n(4842),i=n(298),o=n(3969),d=n(2579),c=n(3759),u=n(6803),x=n(1968),h=n(6020),m=n(4799),p=n(8259),j=n(7443),A=n(756),g=n(6172),v=n(1341),y=n(4375),_=n(4527),f=n(2842),b=n(8315),S=n(9817),w=n(9130),T=n(7121),k=n(8191),C=n(9982),I=n(8209),W=n(7186),F=n(6013),P=n(3216),D=n(8677),z=n(9066),Z=n(7776),L=n(9723),M=n(322),E=n(7907),N=n(3593),R=n(3188),B=n(7764),$=n(579);const O=()=>{const{id:e}=(0,P.g)(),{user:r}=(0,z.A)(),{showSuccess:n,showError:O}=(0,Z.d)(),H=(0,P.Zp)(),{addMessageHandler:J,removeMessageHandler:U}=(0,L.h)(),[q,G]=(0,s.useState)(null),[K,Q]=(0,s.useState)([]),[V,X]=(0,s.useState)([]),[Y,ee]=(0,s.useState)(!0),[re,ne]=(0,s.useState)(!1),[te,se]=(0,s.useState)(null),[ae,le]=(0,s.useState)(null),ie=(0,s.useCallback)(async()=>{if(e)try{const[n,t]=await Promise.all([D.kS.getTournament(e),D.kS.getTournamentPlayers(e)]);if(G(n.data),Q(t.data||[]),r&&t.data){const e=t.data.some(e=>e.user_id===r.id);ne(e)}if("in_progress"===n.data.status||"completed"===n.data.status)try{const r=await D.kS.getTournamentStandings(e);X(r.data.standings||[])}catch(s){console.error("Failed to fetch standings:",s)}}catch(s){var n,t;O((null===(n=s.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to load tournament"),H("/tournaments")}finally{ee(!1)}},[e,r,O,H]);(0,s.useEffect)(()=>{ie()},[ie]),(0,s.useEffect)(()=>{if(!e)return;return J("tournament_update",r=>{var n,t;(null===(n=r.payload)||void 0===n||null===(t=n.tournament)||void 0===t?void 0:t.id)===e&&(G(r.payload.tournament),r.payload.players&&Q(r.payload.players))}),J("tournament_started",r=>{var t;(null===(t=r.payload)||void 0===t?void 0:t.tournament_id)===e&&(ie(),n("Tournament has started!"))}),J("blind_level_increased",r=>{var n;(null===(n=r.payload)||void 0===n?void 0:n.tournament_id)===e&&G(e=>e?(0,t.A)((0,t.A)({},e),{},{current_level:r.payload.current_level,level_started_at:(new Date).toISOString()}):null)}),J("player_eliminated",r=>{var n;(null===(n=r.payload)||void 0===n?void 0:n.tournament_id)===e&&ie()}),J("tournament_complete",r=>{var t;(null===(t=r.payload)||void 0===t?void 0:t.tournament_id)===e&&(ie(),n("Tournament complete! Winner: ".concat(r.payload.winner_name)))}),()=>{U("tournament_update"),U("tournament_started"),U("blind_level_increased"),U("player_eliminated"),U("tournament_complete")}},[e,J,U,ie,n]),(0,s.useEffect)(()=>{if(!q||"registering"!==q.status)return void se(null);const e=()=>{if(q.start_time){const e=new Date(q.start_time).getTime(),r=Date.now(),n=Math.max(0,Math.floor((e-r)/1e3));se(n)}else if(q.registration_completed_at){const e=new Date(q.registration_completed_at).getTime(),r=Date.now(),n=Math.floor((r-e)/1e3),t=Math.max(0,q.auto_start_delay-n);se(t)}else se(null)};e();const r=setInterval(e,1e3);return()=>clearInterval(r)},[q]),(0,s.useEffect)(()=>{if(!q||"in_progress"!==q.status||!q.level_started_at)return void le(null);const e=()=>{try{const e=JSON.parse(q.structure).blind_levels[q.current_level-1];if(e){const r=new Date(q.level_started_at).getTime(),n=Date.now(),t=Math.floor((n-r)/1e3),s=Math.max(0,e.duration-t);le(s)}}catch(e){console.error("Failed to parse tournament structure:",e)}};e();const r=setInterval(e,1e3);return()=>clearInterval(r)},[q]);const oe=e=>{if(null===e)return"--:--";const r=Math.floor(e/60),n=e%60;return"".concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))};if(Y)return(0,$.jsx)(M.e,{children:(0,$.jsx)(a.A,{maxWidth:"xl",sx:{py:4},children:(0,$.jsx)(R.k,{})})});if(!q)return(0,$.jsx)(M.e,{children:(0,$.jsx)(a.A,{maxWidth:"xl",sx:{py:4},children:(0,$.jsx)(l.A,{children:"Tournament not found"})})});const de=JSON.parse(q.structure),ce=de.blind_levels[q.current_level-1],ue=de.blind_levels[q.current_level],xe=(null===r||void 0===r?void 0:r.id)===q.creator_id,he=xe&&"registering"===q.status&&q.current_players>=q.min_players,me=xe&&"in_progress"===q.status,pe=xe&&"paused"===q.status;return(0,$.jsx)(M.e,{children:(0,$.jsx)(a.A,{maxWidth:"xl",sx:{py:4},children:(0,$.jsxs)(i.A,{spacing:3,children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:2,children:[(0,$.jsx)(d.A,{onClick:()=>H("/tournaments"),sx:{color:B.lm.text.secondary},children:(0,$.jsx)(b.A,{})}),(0,$.jsxs)(o.A,{children:[(0,$.jsx)(l.A,{variant:"h4",fontWeight:"bold",color:B.lm.text.primary,children:q.name}),(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,mt:.5,children:[(0,$.jsx)(c.A,{label:(e=>{switch(e){case"registering":return"Open for Registration";case"starting":return"Starting Soon...";case"in_progress":return"In Progress";case"paused":return"Paused";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return e}})(q.status),color:(e=>{switch(e){case"registering":return"success";case"starting":case"paused":return"warning";case"in_progress":return"info";case"completed":default:return"default";case"cancelled":return"error"}})(q.status),size:"small"}),(0,$.jsxs)(l.A,{variant:"body2",color:B.lm.text.secondary,children:["Code: ",q.tournament_code]}),(0,$.jsx)(d.A,{size:"small",onClick:()=>{q&&(navigator.clipboard.writeText(q.tournament_code),n("Tournament code copied to clipboard!"))},children:(0,$.jsx)(S.A,{fontSize:"small"})})]})]})]}),(0,$.jsxs)(i.A,{direction:"row",spacing:2,children:["registering"===q.status&&!re&&(0,$.jsxs)(E.$,{variant:"primary",startIcon:(0,$.jsx)(I.A,{}),onClick:async()=>{if(e)try{await D.kS.registerForTournament(e),n("Successfully registered for tournament!"),ie()}catch(s){var r,t;O((null===(r=s.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to register")}},disabled:q.current_players>=q.max_players,children:["Register (",q.buy_in," chips)"]}),"registering"===q.status&&re&&(0,$.jsx)(E.$,{variant:"ghost",startIcon:(0,$.jsx)(T.A,{}),onClick:async()=>{if(e)try{await D.kS.unregisterFromTournament(e),n("Successfully unregistered from tournament"),ie()}catch(s){var r,t;O((null===(r=s.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to unregister")}},children:"Unregister"}),he&&(0,$.jsx)(E.$,{variant:"success",startIcon:(0,$.jsx)(W.A,{}),onClick:async()=>{if(e)try{await D.kS.startTournament(e),n("Tournament started!"),ie()}catch(s){var r,t;O((null===(r=s.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to start tournament")}},children:"Start Tournament Now"}),me&&(0,$.jsx)(E.$,{variant:"warning",startIcon:(0,$.jsx)(k.A,{}),onClick:async()=>{if(e&&window.confirm("Are you sure you want to pause this tournament? All games will be paused."))try{await D.kS.pauseTournament(e),n("Tournament paused"),ie()}catch(s){var r,t;O((null===(r=s.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to pause tournament")}},children:"Pause Tournament"}),pe&&(0,$.jsx)(E.$,{variant:"success",startIcon:(0,$.jsx)(W.A,{}),onClick:async()=>{if(e)try{await D.kS.resumeTournament(e),n("Tournament resumed"),ie()}catch(s){var r,t;O((null===(r=s.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to resume tournament")}},children:"Resume Tournament"})]})]}),"paused"===q.status&&(0,$.jsxs)(u.A,{severity:"warning",children:[(0,$.jsx)(x.A,{children:"Tournament Paused"}),"This tournament is currently paused. All games are on hold.",xe&&' Click "Resume Tournament" to continue.']}),(0,$.jsxs)(o.A,{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(4, 1fr)"},gap:3,children:[(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(i.A,{spacing:1,p:2,children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(C.A,{sx:{color:B.lm.secondary.main}}),(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Players"})]}),(0,$.jsxs)(l.A,{variant:"h5",fontWeight:"bold",children:[q.current_players," / ",q.max_players]}),(0,$.jsx)(h.A,{variant:"determinate",value:q.current_players/q.max_players*100,sx:{mt:1}}),(0,$.jsxs)(l.A,{variant:"caption",color:B.lm.text.secondary,children:["Min: ",q.min_players]})]})})}),(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(i.A,{spacing:1,p:2,children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(w.A,{sx:{color:B.lm.warning.main}}),(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Prize Pool"})]}),(0,$.jsxs)(l.A,{variant:"h5",fontWeight:"bold",children:[q.prize_pool.toLocaleString()," chips"]}),(0,$.jsxs)(l.A,{variant:"caption",color:B.lm.text.secondary,children:["Buy-in: ",q.buy_in," chips"]})]})})}),"registering"===q.status&&null!==te&&(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(i.A,{spacing:1,p:2,children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(f.A,{sx:{color:B.lm.info.main}}),(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Starts In"})]}),(0,$.jsx)(l.A,{variant:"h5",fontWeight:"bold",sx:{fontFamily:"monospace"},children:oe(te)}),(0,$.jsx)(l.A,{variant:"caption",color:B.lm.text.secondary,children:q.start_time?"Scheduled start":"Auto-start delay"})]})})}),"in_progress"===q.status&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(i.A,{spacing:1,p:2,children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(F.A,{sx:{color:B.lm.success.main}}),(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Current Blinds"})]}),(0,$.jsxs)(l.A,{variant:"h5",fontWeight:"bold",children:[null===ce||void 0===ce?void 0:ce.small_blind," / ",null===ce||void 0===ce?void 0:ce.big_blind]}),(0,$.jsxs)(l.A,{variant:"caption",color:B.lm.text.secondary,children:["Level ",q.current_level,(null===ce||void 0===ce?void 0:ce.ante)>0&&" \u2022 Ante: ".concat(ce.ante)]})]})})}),(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(i.A,{spacing:1,p:2,children:[(0,$.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(f.A,{sx:{color:B.lm.warning.main}}),(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Next Level In"})]}),(0,$.jsx)(l.A,{variant:"h5",fontWeight:"bold",sx:{fontFamily:"monospace"},children:oe(ae)}),ue&&(0,$.jsxs)(l.A,{variant:"caption",color:B.lm.text.secondary,children:["Next: ",ue.small_blind,"/",ue.big_blind]})]})})})]})]}),"registering"===q.status&&(0,$.jsx)(N.Z,{children:(0,$.jsxs)(o.A,{p:3,children:[(0,$.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"Registered Players"}),0===K.length?(0,$.jsx)(l.A,{color:B.lm.text.secondary,children:"No players registered yet. Be the first!"}):(0,$.jsx)(o.A,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:2,children:K.map(e=>(0,$.jsx)(o.A,{children:(0,$.jsxs)(m.A,{sx:{p:2,bgcolor:B.lm.background.paper},children:[(0,$.jsx)(l.A,{fontWeight:"bold",children:e.username}),(0,$.jsxs)(l.A,{variant:"caption",color:B.lm.text.secondary,children:["Registered ",new Date(e.registered_at).toLocaleTimeString()]})]})},e.user_id))})]})}),"starting"===q.status&&(0,$.jsx)(N.Z,{children:(0,$.jsxs)(o.A,{p:3,textAlign:"center",children:[(0,$.jsx)(R.k,{}),(0,$.jsx)(l.A,{variant:"h6",mt:2,children:"Tournament is starting..."}),(0,$.jsx)(l.A,{color:B.lm.text.secondary,children:"Please wait while tables are being prepared"})]})}),("in_progress"===q.status||"completed"===q.status)&&V.length>0&&(0,$.jsx)(N.Z,{children:(0,$.jsxs)(o.A,{p:3,children:[(0,$.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"completed"===q.status?"Final Standings":"Current Standings"}),(0,$.jsx)(p.A,{children:(0,$.jsxs)(j.A,{children:[(0,$.jsx)(A.A,{children:(0,$.jsxs)(g.A,{children:[(0,$.jsx)(v.A,{children:"Position"}),(0,$.jsx)(v.A,{children:"Player"}),(0,$.jsx)(v.A,{align:"right",children:"Chips"}),"completed"===q.status&&(0,$.jsx)(v.A,{align:"right",children:"Prize"}),(0,$.jsx)(v.A,{children:"Status"})]})}),(0,$.jsx)(y.A,{children:V.sort((e,r)=>(e.position||999)-(r.position||999)).map(e=>{const r=K.find(r=>r.user_id===e.user_id);return(0,$.jsxs)(g.A,{children:[(0,$.jsx)(v.A,{children:e.position?(0,$.jsx)(c.A,{label:"#".concat(e.position),color:1===e.position?"warning":"default",size:"small"}):"-"}),(0,$.jsx)(v.A,{children:e.username||(null===r||void 0===r?void 0:r.username)||"Unknown"}),(0,$.jsx)(v.A,{align:"right",children:(null===r||void 0===r?void 0:r.chips.toLocaleString())||"-"}),"completed"===q.status&&(0,$.jsx)(v.A,{align:"right",children:e.prize_amount>0?(0,$.jsxs)(l.A,{color:B.lm.success.main,fontWeight:"bold",children:["+",e.prize_amount.toLocaleString()]}):"-"}),(0,$.jsx)(v.A,{children:e.position?(0,$.jsx)(c.A,{label:"Eliminated",size:"small",color:"error"}):(0,$.jsx)(c.A,{label:"Active",size:"small",color:"success"})})]},e.user_id)})})]})})]})}),"cancelled"===q.status&&(0,$.jsx)(N.Z,{children:(0,$.jsxs)(o.A,{p:3,textAlign:"center",children:[(0,$.jsx)(l.A,{variant:"h6",color:"error",mb:1,children:"Tournament Cancelled"}),(0,$.jsx)(l.A,{color:B.lm.text.secondary,children:"This tournament has been cancelled. All buy-ins have been refunded."})]})}),(0,$.jsxs)(o.A,{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:3,children:[(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(o.A,{p:3,children:[(0,$.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"Blind Structure"}),(0,$.jsx)(l.A,{variant:"subtitle2",color:B.lm.text.secondary,mb:2,children:de.name}),(0,$.jsx)(p.A,{children:(0,$.jsxs)(j.A,{size:"small",children:[(0,$.jsx)(A.A,{children:(0,$.jsxs)(g.A,{children:[(0,$.jsx)(v.A,{children:"Level"}),(0,$.jsx)(v.A,{children:"Small/Big"}),(0,$.jsx)(v.A,{children:"Ante"}),(0,$.jsx)(v.A,{children:"Duration"})]})}),(0,$.jsx)(y.A,{children:de.blind_levels.slice(0,10).map(e=>(0,$.jsxs)(g.A,{sx:{bgcolor:e.level===q.current_level?"rgba(25, 118, 210, 0.08)":"transparent"},children:[(0,$.jsx)(v.A,{children:e.level}),(0,$.jsxs)(v.A,{children:[e.small_blind,"/",e.big_blind]}),(0,$.jsx)(v.A,{children:e.ante||"-"}),(0,$.jsxs)(v.A,{children:[e.duration/60," min"]})]},e.level))})]})})]})})}),(0,$.jsx)(o.A,{children:(0,$.jsx)(N.Z,{children:(0,$.jsxs)(o.A,{p:3,children:[(0,$.jsx)(l.A,{variant:"h6",fontWeight:"bold",mb:2,children:"Tournament Info"}),(0,$.jsxs)(i.A,{spacing:2,children:[(0,$.jsxs)(o.A,{children:[(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Starting Chips"}),(0,$.jsx)(l.A,{variant:"body1",fontWeight:"bold",children:q.starting_chips.toLocaleString()})]}),(0,$.jsx)(_.A,{}),(0,$.jsxs)(o.A,{children:[(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Structure"}),(0,$.jsx)(l.A,{variant:"body1",children:de.description})]}),(0,$.jsx)(_.A,{}),(0,$.jsxs)(o.A,{children:[(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Created"}),(0,$.jsx)(l.A,{variant:"body1",children:new Date(q.created_at).toLocaleString()})]}),q.started_at&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(_.A,{}),(0,$.jsxs)(o.A,{children:[(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Started"}),(0,$.jsx)(l.A,{variant:"body1",children:new Date(q.started_at).toLocaleString()})]})]}),q.completed_at&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(_.A,{}),(0,$.jsxs)(o.A,{children:[(0,$.jsx)(l.A,{variant:"body2",color:B.lm.text.secondary,children:"Completed"}),(0,$.jsx)(l.A,{variant:"body1",children:new Date(q.completed_at).toLocaleString()})]})]})]})]})})})]})]})})})}}}]);
//# sourceMappingURL=97.48836a8f.chunk.js.map